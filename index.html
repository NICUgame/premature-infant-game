<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>NICU æ—©ç”¢å…’åˆä½µç—‡è©•ä¼°æ¨¡æ“¬å™¨</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap');

:root {
  --bg-deep: #0d1b2a;
  --bg-panel: #1b2d44;
  --bg-card: #213448;
  --accent-blue: #5dadec;
  --accent-teal: #4ecdc4;
  --accent-coral: #ff6b6b;
  --accent-amber: #f4a261;
  --accent-green: #6bcb77;
  --text-primary: #e8edf2;
  --text-secondary: #8fa3b8;
  --text-dim: #5a7085;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Noto Sans TC', sans-serif;
  background: var(--bg-deep);
  color: var(--text-primary);
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-tap-highlight-color: transparent;
  overscroll-behavior: none;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    linear-gradient(rgba(93,173,236,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(93,173,236,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
  z-index: 0;
}

/* ==================== TITLE SCREEN ==================== */
#title-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  min-height: 100dvh;
  position: relative;
  z-index: 1;
  padding: 1.5rem 1rem;
}

.title-badge {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  color: var(--bg-deep);
  padding: 0.3rem 1rem;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 1rem;
  animation: fadeSlideDown 0.8s ease;
}

.title-main {
  font-size: 1.8rem;
  font-weight: 900;
  text-align: center;
  line-height: 1.3;
  margin-bottom: 0.5rem;
  animation: fadeSlideDown 0.8s ease 0.1s both;
}

.title-main .highlight {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.title-sub {
  font-size: 0.9rem;
  color: var(--text-secondary);
  text-align: center;
  max-width: 500px;
  line-height: 1.7;
  margin-bottom: 1.5rem;
  animation: fadeSlideDown 0.8s ease 0.2s both;
}

.title-conditions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
  max-width: 600px;
  margin-bottom: 2rem;
  animation: fadeSlideDown 0.8s ease 0.3s both;
}

.condition-tag {
  background: var(--bg-panel);
  border: 1px solid rgba(93,173,236,0.2);
  padding: 0.4rem 0.8rem;
  border-radius: 8px;
  font-size: 0.72rem;
  color: var(--text-secondary);
  transition: all 0.3s;
}

.btn-start {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  color: var(--bg-deep);
  border: none;
  padding: 0.9rem 2.5rem;
  font-size: 1rem;
  font-weight: 700;
  font-family: 'Noto Sans TC', sans-serif;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  animation: fadeSlideDown 0.8s ease 0.4s both;
}

.btn-start:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(93,173,236,0.3);
}

.copyright-footer {
  position: absolute;
  bottom: 1rem;
  right: 1.2rem;
  font-size: 0.6rem;
  color: var(--text-dim);
  letter-spacing: 0.3px;
  animation: fadeSlideDown 0.8s ease 0.5s both;
}

.copyright-footer a {
  color: var(--text-dim);
  text-decoration: none;
  transition: color 0.3s;
}

.copyright-footer a:hover { color: var(--accent-blue); }

/* ==================== TUTORIAL OVERLAY ==================== */
.tutorial-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(13, 27, 42, 0.92);
  backdrop-filter: blur(8px);
  z-index: 200;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.tutorial-overlay.active { display: flex; }

.tutorial-card {
  background: var(--bg-panel);
  border: 1px solid rgba(93,173,236,0.2);
  border-radius: 16px;
  padding: 2rem 1.5rem;
  max-width: 380px;
  width: 100%;
  text-align: center;
  animation: feedbackIn 0.4s ease;
}

.tutorial-card h2 {
  font-size: 1.1rem;
  color: var(--accent-blue);
  margin-bottom: 1.5rem;
  font-weight: 700;
}

.tutorial-steps-wrapper {
  position: relative;
  min-height: 160px;
  margin-bottom: 1.2rem;
}

.tutorial-step {
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 0.8rem;
  animation: fadeSlideDown 0.4s ease;
}

.tutorial-step.active { display: flex; }

.tutorial-step-icon {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: rgba(93,173,236,0.1);
  border: 2px solid rgba(93,173,236,0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
}

.tutorial-step h3 {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-primary);
}

.tutorial-step p {
  font-size: 0.82rem;
  color: var(--text-secondary);
  line-height: 1.7;
  max-width: 300px;
}

.tutorial-step p strong { color: var(--accent-teal); }

.tutorial-dots {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 1.2rem;
}

.tutorial-dots .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-dim);
  transition: all 0.3s;
}

.tutorial-dots .dot.active {
  background: var(--accent-blue);
  transform: scale(1.3);
}

.tutorial-actions {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.8rem;
}

.tutorial-skip {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.72rem;
  color: var(--text-dim);
  cursor: pointer;
}

.tutorial-skip input {
  accent-color: var(--accent-blue);
}

.tutorial-btn {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  color: var(--bg-deep);
  border: none;
  padding: 0.7rem 2rem;
  font-size: 0.9rem;
  font-weight: 700;
  font-family: 'Noto Sans TC', sans-serif;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
  min-width: 140px;
}

.tutorial-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(93,173,236,0.3);
}

/* ==================== GAME SCREEN ==================== */
#game-screen {
  display: none;
  height: 100vh;
  height: 100dvh;
  flex-direction: column;
  position: relative;
  z-index: 1;
  overflow: hidden;
}

/* Top Bar */
.top-bar {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.3rem 0.8rem;
  height: 40px;
  background: rgba(27, 45, 68, 0.9);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(93,173,236,0.1);
}

.round-info {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.round-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.7rem;
  color: var(--accent-blue);
  font-weight: 600;
}

.progress-bar {
  width: 60px;
  height: 4px;
  background: var(--bg-card);
  border-radius: 2px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-teal));
  border-radius: 2px;
  transition: width 0.5s ease;
}

/* Timer */
.timer-container {
  position: relative;
  width: 36px;
  height: 36px;
  flex-shrink: 0;
}

.timer-svg {
  width: 36px;
  height: 36px;
  transform: rotate(-90deg);
}

.timer-track {
  fill: none;
  stroke: rgba(93,173,236,0.12);
  stroke-width: 3;
}

.timer-progress {
  fill: none;
  stroke: var(--accent-teal);
  stroke-width: 3;
  stroke-linecap: round;
  stroke-dasharray: 97.389;
  stroke-dashoffset: 0;
  transition: stroke 0.3s;
}

.timer-text {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--accent-teal);
  transition: color 0.3s;
}

.timer-container.warning .timer-progress { stroke: var(--accent-amber); }
.timer-container.warning .timer-text { color: var(--accent-amber); }

.timer-container.danger .timer-progress { stroke: var(--accent-coral); }
.timer-container.danger .timer-text { color: var(--accent-coral); }
.timer-container.danger { animation: timerPulse 0.5s ease-in-out infinite; }

@keyframes timerPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}

.score-display {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
}

.score-display .score-icon { color: var(--accent-amber); }
.score-display .score-val { color: var(--accent-amber); font-weight: 600; }

/* ==================== GAME LAYOUT (Mobile-first: flex column) ==================== */
.game-layout {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

/* Right panel flattens on mobile */
.right-panel { display: contents; }

/* ==================== INCUBATOR AREA ==================== */
.incubator-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 0;
  padding: 0.3rem 0.5rem 0;
  order: 1;
}

.incubator-frame {
  flex: 1;
  width: 100%;
  position: relative;
  background: rgba(173, 216, 255, 0.04);
  border: 1px solid rgba(93,173,236,0.12);
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 0;
  box-shadow: 0 0 30px rgba(93,173,236,0.04), inset 0 0 40px rgba(0,0,0,0.2);
}

.incubator-label {
  position: absolute;
  top: 6px;
  left: 10px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.5rem;
  color: var(--text-dim);
  letter-spacing: 1px;
  text-transform: uppercase;
  z-index: 5;
}

.incubator-temp {
  position: absolute;
  top: 6px;
  right: 10px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.55rem;
  color: var(--accent-teal);
  z-index: 5;
}

/* Baby wrapper */
.baby-wrapper {
  position: relative;
  width: 52%;
  max-width: 220px;
}

.baby-wrapper img.baby-base {
  width: 100%;
  height: auto;
  display: block;
  transition: filter 0.5s ease;
}

/* Condition-specific image filters */
.baby-wrapper.cond-rds img.baby-base {
  filter: hue-rotate(220deg) saturate(0.5) brightness(0.92);
}

.baby-wrapper.cond-ivh img.baby-base {
  filter: saturate(0.35) brightness(1.05);
}

.baby-wrapper.cond-nec img.baby-base {
  filter: saturate(0.55) brightness(0.9) sepia(0.15);
}

.baby-wrapper.cond-pda img.baby-base,
.baby-wrapper.cond-rop img.baby-base {
  filter: none;
}

/* ==================== HOTSPOT ZONES ==================== */
.hotspot-zone {
  position: absolute;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s;
  z-index: 10;
  touch-action: manipulation;
  -webkit-touch-callout: none;
  user-select: none;
}

.hotspot-zone::before {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: 50%;
  border: 2px solid rgba(93,173,236,0.35);
  animation: hotspotPulse 2s ease-in-out infinite;
  pointer-events: none;
}

.hotspot-zone:hover::before { border-color: rgba(93,173,236,0.7); }
.hotspot-zone:hover { background: rgba(93,173,236,0.12); }

.hotspot-zone.discovered::before {
  border-color: rgba(78,205,196,0.4);
  animation: none;
}

.hotspot-zone.discovered { background: rgba(78,205,196,0.08); }

.zone-head    { width: 40%; height: 13%; top: 0%;  left: 28%; border-radius: 40%; }
.zone-face    { width: 32%; height: 14%; top: 15%; left: 34%; border-radius: 40%; }
.zone-chest   { width: 30%; height: 10%; top: 42%; left: 35%; border-radius: 40%; }
.zone-abdomen { width: 26%; height: 10%; top: 55%; left: 37%; border-radius: 40%; z-index: 11; }
.zone-limbs   { width: 92%; height: 18%; top: 70%; left: 4%;  border-radius: 30%; }
.zone-monitor { width: 26%; height: 12%; top: -2%; right: -4%; left: auto; border-radius: 8px; background: rgba(93,173,236,0.06); border: 1px solid rgba(93,173,236,0.18); display: flex; align-items: center; justify-content: center; gap: 4px; min-width: auto; min-height: auto; }
.zone-monitor::before { border-radius: 8px; }
.zone-monitor svg { width: 11px; height: 11px; }
.zone-monitor span { font-size: 0.5rem; color: var(--text-dim); letter-spacing: 0.5px; }

/* ==================== SYMPTOM OVERLAYS ==================== */
.baby-wrapper.cond-rds .overlay-chest-retract { display: block; }
.overlay-chest-retract {
  display: none;
  position: absolute;
  top: 42%; left: 32%; width: 36%; height: 14%;
  border-radius: 50%;
  background: rgba(0,0,0,0.08);
  animation: chestRetract 1.3s ease-in-out infinite;
  pointer-events: none; z-index: 2;
}

@keyframes chestRetract {
  0%, 100% { transform: scaleY(1); opacity: 0; }
  40% { transform: scaleY(0.7); opacity: 0.25; }
  60% { transform: scaleY(0.8); opacity: 0.15; }
}

.baby-wrapper.cond-rds .overlay-nasal-flare { display: block; }
.overlay-nasal-flare {
  display: none;
  position: absolute;
  top: 26%; left: 46%; width: 10%; height: 4%;
  pointer-events: none; z-index: 3;
}

.overlay-nasal-flare::before,
.overlay-nasal-flare::after {
  content: '';
  position: absolute;
  width: 8px; height: 6px;
  background: rgba(180,130,160,0.5);
  border-radius: 50%;
  animation: nasalFlare 1.3s ease-in-out infinite;
}

.overlay-nasal-flare::before { left: 0; }
.overlay-nasal-flare::after { right: 0; }

@keyframes nasalFlare {
  0%, 60%, 100% { transform: scaleX(1); }
  30% { transform: scaleX(1.6); }
}

.baby-wrapper.cond-rds .overlay-grunt-waves { display: flex; }
.overlay-grunt-waves {
  display: none;
  position: absolute;
  top: 30%; left: 62%;
  gap: 3px;
  pointer-events: none; z-index: 3;
}

.grunt-wave {
  width: 8px; height: 8px;
  border: 1.5px solid rgba(180,130,160,0.6);
  border-radius: 50%;
  animation: gruntWave 1.8s ease-out infinite;
}

.grunt-wave:nth-child(2) { animation-delay: 0.3s; }
.grunt-wave:nth-child(3) { animation-delay: 0.6s; }

@keyframes gruntWave {
  0% { opacity: 0; transform: scale(0.5); }
  30% { opacity: 0.7; }
  100% { opacity: 0; transform: scale(1.8) translateX(8px); }
}

.baby-wrapper.cond-pda .overlay-heart-pulse { display: block; }
.overlay-heart-pulse {
  display: none;
  position: absolute;
  top: 43%; left: 38%; width: 24%; height: 10%;
  pointer-events: none; z-index: 2;
}

.overlay-heart-pulse::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: rgba(255,107,107,0.15);
  animation: heartPulse 0.8s ease infinite;
}

@keyframes heartPulse {
  0%, 100% { transform: scale(1); opacity: 0.3; }
  15% { transform: scale(1.2); opacity: 0.6; }
  30% { transform: scale(1); opacity: 0.3; }
  45% { transform: scale(1.1); opacity: 0.5; }
}

.baby-wrapper.cond-pda .overlay-bounding-pulse { display: block; }
.overlay-bounding-pulse {
  display: none;
  position: absolute;
  pointer-events: none; z-index: 3;
}

.bounding-dot {
  position: absolute;
  width: 12px; height: 12px;
  border: 2px solid rgba(255,107,107,0.5);
  border-radius: 50%;
  animation: boundingPulse 0.8s ease infinite;
}

.bounding-dot.left-wrist { top: 0; left: 0; }
.bounding-dot.right-wrist { top: 0; right: 0; }
.bounding-dot:nth-child(2) { animation-delay: 0.4s; }

@keyframes boundingPulse {
  0%, 100% { transform: scale(1); opacity: 0.4; }
  50% { transform: scale(1.5); opacity: 0.8; }
}

.baby-wrapper.cond-pda .overlay-murmur { display: block; }
.overlay-murmur {
  display: none;
  position: absolute;
  top: 42%; left: 28%; width: 20px; height: 30px;
  pointer-events: none; z-index: 3;
}

.murmur-line {
  position: absolute;
  width: 14px; height: 2px;
  background: rgba(93,173,236,0.5);
  border-radius: 1px;
  animation: murmurWave 1.2s linear infinite;
}

.murmur-line:nth-child(1) { top: 5px; }
.murmur-line:nth-child(2) { top: 13px; animation-delay: 0.4s; }
.murmur-line:nth-child(3) { top: 21px; animation-delay: 0.8s; }

@keyframes murmurWave {
  0% { opacity: 0.5; transform: translateX(0); }
  100% { opacity: 0; transform: translateX(-18px); }
}

.baby-wrapper.cond-ivh .overlay-fontanelle { display: block; }
.overlay-fontanelle {
  display: none;
  position: absolute;
  top: 1%; left: 42%; width: 16%; height: 6%;
  pointer-events: none; z-index: 3;
}

.overlay-fontanelle::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: rgba(255,180,160,0.25);
  animation: fontanelleBulge 2s ease-in-out infinite;
}

@keyframes fontanelleBulge {
  0%, 100% { transform: scaleY(1); }
  50% { transform: scaleY(1.5) translateY(-3px); }
}

.baby-wrapper.cond-ivh { animation: seizureTwitch 4s ease infinite; }

@keyframes seizureTwitch {
  0%, 84%, 100% { transform: translateX(0) rotate(0deg); }
  86% { transform: translateX(2px) rotate(0.4deg); }
  88% { transform: translateX(-3px) rotate(-0.5deg); }
  90% { transform: translateX(2px) rotate(0.3deg); }
  92% { transform: translateX(-1px) rotate(-0.2deg); }
  94% { transform: translateX(1px) rotate(0.1deg); }
}

.baby-wrapper.cond-nec .overlay-abdomen-distend { display: block; }
.overlay-abdomen-distend {
  display: none;
  position: absolute;
  top: 55%; left: 34%; width: 32%; height: 14%;
  border-radius: 50%;
  pointer-events: none; z-index: 2;
  animation: abdDistend 3s ease-in-out infinite;
}

.overlay-abdomen-distend::before {
  content: '';
  position: absolute; inset: 0;
  border-radius: 50%;
  background: rgba(240,200,170,0.2);
  box-shadow: 0 0 15px rgba(240,180,140,0.15);
}

.overlay-abdomen-distend::after {
  content: '';
  position: absolute;
  top: 15%; left: 20%; width: 40%; height: 30%;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
}

@keyframes abdDistend {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.12); }
}

.baby-wrapper.cond-nec .overlay-blood-spot { display: block; }
.overlay-blood-spot {
  display: none;
  position: absolute;
  top: 65%; left: 48%;
  pointer-events: none; z-index: 3;
}

.overlay-blood-spot::before {
  content: '';
  position: absolute;
  width: 6px; height: 6px;
  background: rgba(180,80,60,0.4);
  border-radius: 50%;
}

.overlay-blood-spot::after {
  content: '';
  position: absolute;
  top: 8px; left: -5px;
  width: 4px; height: 4px;
  background: rgba(160,70,50,0.3);
  border-radius: 50%;
}

.baby-wrapper.cond-rop .overlay-eye-hint { display: block; }
.overlay-eye-hint {
  display: none;
  position: absolute;
  top: 20%; left: 36%; width: 28%; height: 8%;
  border: 2px dashed rgba(244,162,97,0.3);
  border-radius: 50%;
  pointer-events: none; z-index: 3;
  animation: eyeHintPulse 3s ease-in-out infinite;
}

@keyframes eyeHintPulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.7; }
}

/* ==================== PROMPT BAR ==================== */
.prompt-bar {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.6rem;
  padding: 0.25rem 0.8rem;
  order: 2;
}

.prompt-text {
  font-size: 0.72rem;
  color: var(--text-secondary);
}

.clue-toggle-btn {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  background: rgba(93,173,236,0.1);
  border: 1px solid rgba(93,173,236,0.25);
  color: var(--accent-blue);
  padding: 0.25rem 0.7rem;
  border-radius: 20px;
  font-size: 0.68rem;
  font-family: 'Noto Sans TC', sans-serif;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  flex-shrink: 0;
}

.clue-toggle-btn:hover {
  background: rgba(93,173,236,0.2);
  border-color: var(--accent-blue);
}

.clue-toggle-btn.has-new {
  animation: clueNotify 0.5s ease;
}

@keyframes clueNotify {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* ==================== VITALS MONITOR ==================== */
.vitals-monitor {
  flex-shrink: 0;
  order: 3;
  background: #0a1520;
  border-top: 1px solid rgba(93,173,236,0.08);
  border-bottom: 1px solid rgba(93,173,236,0.08);
  padding: 0.25rem 0.6rem;
  font-family: 'JetBrains Mono', monospace;
}

.vitals-header {
  display: none;
  font-size: 0.6rem;
  color: var(--text-dim);
  letter-spacing: 1px;
  margin-bottom: 0.5rem;
  align-items: center;
  gap: 0.5rem;
}

.vitals-header .dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--accent-green);
  animation: blink 1s ease infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.waveform-container {
  display: none;
  height: 45px;
  margin: 0.3rem 0;
  overflow: hidden;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  border: 1px solid rgba(93,173,236,0.08);
}

.waveform-canvas { width: 100%; height: 100%; }

#vitals-rows {
  display: flex;
  gap: 0.25rem;
  flex-wrap: nowrap;
}

.vital-row {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0.1rem 0.2rem;
  background: rgba(255,255,255,0.02);
  border-radius: 3px;
  gap: 0;
}

.vital-label { font-size: 0.5rem; color: var(--text-dim); }
.vital-value { font-size: 0.75rem; font-weight: 600; }
.vital-value.normal { color: var(--accent-green); }
.vital-value.warning { color: var(--accent-amber); }
.vital-value.danger { color: var(--accent-coral); }
.vital-unit { font-size: 0.45rem; color: var(--text-dim); margin-left: 1px; }

/* ==================== DIAGNOSIS PANEL ==================== */
.diagnosis-panel {
  flex-shrink: 0;
  order: 4;
  padding: 0.35rem 0.6rem;
  padding-bottom: calc(0.35rem + env(safe-area-inset-bottom, 0px));
  background: var(--bg-deep);
  border-top: 1px solid rgba(93,173,236,0.08);
}

.diagnosis-panel .panel-header {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.62rem;
  font-weight: 700;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding-bottom: 0.25rem;
  margin-bottom: 0.25rem;
}

#diagnosis-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4px;
}

.diagnosis-btn {
  background: var(--bg-panel);
  border: 1px solid rgba(93,173,236,0.1);
  border-radius: 8px;
  padding: 0.4rem 0.5rem;
  color: var(--text-secondary);
  font-family: 'Noto Sans TC', sans-serif;
  font-size: 0.68rem;
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  touch-action: manipulation;
  line-height: 1.3;
}

.diagnosis-btn .diag-num {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  background: rgba(93,173,236,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.6rem;
  color: var(--accent-blue);
  flex-shrink: 0;
}

.diagnosis-btn:active {
  transform: scale(0.97);
}

.diagnosis-btn.correct {
  border-color: var(--accent-green);
  background: rgba(107,203,119,0.1);
  color: var(--accent-green);
}

.diagnosis-btn.wrong {
  border-color: var(--accent-coral);
  background: rgba(255,107,107,0.08);
  color: var(--accent-coral);
  opacity: 0.6;
}

.diagnosis-btn:disabled { cursor: default; pointer-events: none; }

.submit-hint {
  font-size: 0.58rem;
  color: var(--text-dim);
  text-align: center;
  padding-top: 0.2rem;
}

/* ==================== CLUES BOTTOM SHEET (Mobile) ==================== */
.clue-backdrop {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 65;
}

.clue-backdrop.active { display: block; }

.clues-container {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  max-height: 55vh;
  background: var(--bg-panel);
  border-radius: 16px 16px 0 0;
  transform: translateY(100%);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 70;
  display: flex;
  flex-direction: column;
  box-shadow: 0 -8px 30px rgba(0,0,0,0.4);
}

.clues-container.open { transform: translateY(0); }

.sheet-handle {
  width: 36px;
  height: 4px;
  background: rgba(255,255,255,0.2);
  border-radius: 2px;
  margin: 8px auto 4px;
  flex-shrink: 0;
}

.clues-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.3rem 1rem 0.5rem;
  border-bottom: 1px solid rgba(93,173,236,0.1);
  flex-shrink: 0;
}

.clues-title {
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--text-secondary);
}

.clues-close-btn {
  background: none;
  border: none;
  color: var(--text-dim);
  font-size: 1.1rem;
  cursor: pointer;
  padding: 0.2rem;
  line-height: 1;
}

.clue-instruction {
  font-size: 0.72rem;
  color: var(--text-dim);
  line-height: 1.5;
  padding: 0.5rem 1rem;
  border-left: 3px solid var(--accent-blue);
  margin: 0.5rem 0.8rem;
  background: rgba(93,173,236,0.04);
  border-radius: 0 6px 6px 0;
  flex-shrink: 0;
}

.clue-list {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  max-height: calc(55vh - 110px);
  overflow-y: scroll;
  overscroll-behavior-y: contain;
  -webkit-overflow-scrolling: touch;
  padding: 0.4rem 0.8rem 0.8rem;
}

.clue-item {
  background: var(--bg-card);
  border: 1px solid rgba(93,173,236,0.08);
  border-radius: 8px;
  padding: 0.6rem 0.7rem;
  animation: clueAppear 0.4s ease;
  font-size: 0.75rem;
  line-height: 1.5;
}

.clue-item .clue-label {
  color: var(--accent-teal);
  font-weight: 600;
  font-size: 0.68rem;
  margin-bottom: 0.2rem;
}

.clue-item .clue-text { color: var(--text-secondary); }

@keyframes clueAppear {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

/* ==================== FEEDBACK OVERLAY ==================== */
.feedback-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(13, 27, 42, 0.9);
  backdrop-filter: blur(8px);
  z-index: 100;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.feedback-overlay.active { display: flex; }

.feedback-card {
  background: var(--bg-panel);
  border: 1px solid rgba(93,173,236,0.2);
  border-radius: 16px;
  padding: 1.5rem;
  max-width: 500px;
  width: 100%;
  max-height: 88vh;
  overflow-y: auto;
  animation: feedbackIn 0.4s ease;
}

@keyframes feedbackIn {
  from { opacity: 0; transform: scale(0.95) translateY(10px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.feedback-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 0.8rem;
  font-size: 1.3rem;
}

.feedback-icon.correct {
  background: rgba(107,203,119,0.15);
  border: 2px solid var(--accent-green);
  color: var(--accent-green);
}

.feedback-icon.wrong {
  background: rgba(255,107,107,0.15);
  border: 2px solid var(--accent-coral);
  color: var(--accent-coral);
}

.feedback-icon.timeout {
  background: rgba(244,162,97,0.15);
  border: 2px solid var(--accent-amber);
  color: var(--accent-amber);
}

.feedback-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.3rem; }
.feedback-title.correct { color: var(--accent-green); }
.feedback-title.wrong { color: var(--accent-coral); }
.feedback-title.timeout { color: var(--accent-amber); }

.feedback-answer {
  font-size: 0.9rem;
  color: var(--accent-blue);
  font-weight: 600;
  margin-bottom: 0.8rem;
}

.feedback-explanation {
  font-size: 0.78rem;
  color: var(--text-secondary);
  line-height: 1.7;
  margin-bottom: 1.2rem;
  padding: 0.8rem;
  background: rgba(0,0,0,0.2);
  border-radius: 10px;
  border-left: 3px solid var(--accent-blue);
}

.feedback-explanation strong { color: var(--accent-teal); }

.btn-next {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  color: var(--bg-deep);
  border: none;
  padding: 0.7rem 2rem;
  font-size: 0.9rem;
  font-weight: 700;
  font-family: 'Noto Sans TC', sans-serif;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
  width: 100%;
}

.btn-next:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(93,173,236,0.3);
}

/* ==================== RESULTS SCREEN ==================== */
#results-screen {
  display: none;
  min-height: 100vh;
  min-height: 100dvh;
  position: relative;
  z-index: 1;
  align-items: center;
  justify-content: center;
  padding: 1.5rem;
}

.results-card {
  background: var(--bg-panel);
  border: 1px solid rgba(93,173,236,0.2);
  border-radius: 20px;
  padding: 2rem 1.5rem;
  max-width: 450px;
  width: 100%;
  text-align: center;
  animation: feedbackIn 0.5s ease;
}

.results-score-circle {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  margin: 0 auto 1.2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: 'JetBrains Mono', monospace;
}

.results-score-circle .big-num { font-size: 2rem; font-weight: 700; }
.results-score-circle .of-total { font-size: 0.75rem; }

.results-score-circle.excellent {
  background: rgba(107,203,119,0.12);
  border: 3px solid var(--accent-green);
  color: var(--accent-green);
}

.results-score-circle.good {
  background: rgba(244,162,97,0.12);
  border: 3px solid var(--accent-amber);
  color: var(--accent-amber);
}

.results-score-circle.needs-work {
  background: rgba(255,107,107,0.12);
  border: 3px solid var(--accent-coral);
  color: var(--accent-coral);
}

.results-message { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.4rem; }

.results-detail {
  font-size: 0.8rem;
  color: var(--text-secondary);
  line-height: 1.6;
  margin-bottom: 1.5rem;
}

.results-breakdown { text-align: left; margin-bottom: 1.5rem; }

.results-row {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.5rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 0.78rem;
}

.results-row .r-icon { font-size: 0.9rem; width: 20px; text-align: center; }
.results-row .r-name { flex: 1; color: var(--text-secondary); }

.results-row .r-result {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem;
  padding: 0.15rem 0.5rem;
  border-radius: 4px;
}

.results-row .r-result.pass { background: rgba(107,203,119,0.15); color: var(--accent-green); }
.results-row .r-result.fail { background: rgba(255,107,107,0.15); color: var(--accent-coral); }

.btn-restart {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  color: var(--bg-deep);
  border: none;
  padding: 0.75rem 2rem;
  font-size: 0.95rem;
  font-weight: 700;
  font-family: 'Noto Sans TC', sans-serif;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
  width: 100%;
}

.btn-restart:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(93,173,236,0.3);
}

/* ==================== ANIMATIONS ==================== */
@keyframes fadeSlideDown {
  from { opacity: 0; transform: translateY(-15px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes hotspotPulse {
  0%, 100% { opacity: 0.3; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(1.08); }
}

::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--text-dim); border-radius: 2px; }

/* ==================== TABLET (>=768px) ==================== */
@media (min-width: 768px) {
  .title-main { font-size: 2.5rem; }
  .title-sub { font-size: 1rem; }
  .btn-start { padding: 1rem 3rem; font-size: 1.1rem; }

  .top-bar { padding: 0.5rem 1.5rem; height: 48px; }
  .round-label { font-size: 0.8rem; }
  .progress-bar { width: 120px; height: 5px; }
  .timer-container { width: 40px; height: 40px; }
  .timer-svg { width: 40px; height: 40px; }
  .timer-text { font-size: 0.7rem; }
  .score-display { font-size: 0.85rem; }

  .vitals-header { display: flex; }
  .waveform-container { display: block; }

  .vitals-monitor {
    padding: 0.6rem 1rem;
    border-radius: 10px;
    border: 1px solid rgba(93,173,236,0.1);
  }

  #vitals-rows .vital-row {
    flex-direction: row;
    justify-content: space-between;
    align-items: baseline;
    padding: 0.3rem 0;
    background: transparent;
    border-bottom: 1px solid rgba(255,255,255,0.03);
  }

  #vitals-rows .vital-row:last-child { border-bottom: none; }
  .vital-label { font-size: 0.65rem; }
  .vital-value { font-size: 0.9rem; }
  .vital-unit { font-size: 0.55rem; }

  #vitals-rows {
    flex-direction: column;
    gap: 0;
  }

  .baby-wrapper { width: 65%; max-width: 300px; }

  .incubator-label { font-size: 0.6rem; }
  .incubator-temp { font-size: 0.65rem; }

  .feedback-card { padding: 2rem; }
  .feedback-icon { width: 56px; height: 56px; font-size: 1.5rem; }
  .feedback-title { font-size: 1.3rem; }
  .feedback-explanation { font-size: 0.85rem; }

  .results-card { padding: 2.5rem; }
  .results-score-circle { width: 110px; height: 110px; }
  .results-score-circle .big-num { font-size: 2.5rem; }
}

/* ==================== DESKTOP (>=1100px) ==================== */
@media (min-width: 1100px) {
  .title-main { font-size: 3rem; }
  .copyright-footer { font-size: 0.7rem; bottom: 1.5rem; right: 2rem; }

  #game-screen { height: 100vh; }

  .top-bar { padding: 0.6rem 2rem; height: 52px; }
  .progress-bar { width: 180px; height: 6px; }

  .game-layout {
    display: grid;
    grid-template-columns: 260px 1fr 280px;
    gap: 1rem;
    padding: 1rem 1.5rem;
  }

  .right-panel {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    order: 3;
  }

  .incubator-area { order: 2; padding: 0; }

  .incubator-frame {
    max-width: 480px;
    aspect-ratio: 3/4;
    border-radius: 20px;
    box-shadow: 0 0 40px rgba(93,173,236,0.05), inset 0 0 60px rgba(0,0,0,0.3);
  }

  .baby-wrapper { width: 75%; max-width: 320px; }

  .incubator-label { font-size: 0.65rem; top: 12px; left: 16px; }
  .incubator-temp { font-size: 0.7rem; top: 12px; right: 16px; }

  .prompt-bar { margin-top: 0.5rem; }
  .prompt-text { font-size: 0.85rem; }
  .clue-toggle-btn { display: none; }

  /* Clues as sidebar on desktop */
  .clues-container {
    position: static;
    transform: none;
    max-height: none;
    border-radius: 0;
    box-shadow: none;
    background: transparent;
    order: 1;
  }

  .sheet-handle { display: none; }
  .clues-close-btn { display: none; }

  .clues-header {
    border-bottom: 1px solid rgba(93,173,236,0.1);
    padding: 0 0 0.5rem;
  }

  .clues-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .clue-instruction { margin: 0.5rem 0; }

  .clue-list {
    max-height: none;
    padding: 0;
  }

  .clue-backdrop { display: none !important; }

  /* Diagnosis panel desktop */
  .diagnosis-panel {
    flex: 1;
    border-top: none;
    padding: 0;
    background: transparent;
  }

  .diagnosis-panel .panel-header {
    font-size: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(93,173,236,0.1);
  }

  #diagnosis-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .diagnosis-btn {
    padding: 0.6rem 0.8rem;
    font-size: 0.8rem;
    border-radius: 10px;
  }

  .diagnosis-btn .diag-num {
    width: 24px;
    height: 24px;
    border-radius: 6px;
    font-size: 0.7rem;
  }

  .diagnosis-btn:hover {
    border-color: var(--accent-blue);
    background: rgba(93,173,236,0.08);
    color: var(--text-primary);
    transform: translateX(4px);
  }

  .submit-hint { font-size: 0.68rem; padding-top: 0.5rem; }

  .vitals-monitor { border-radius: 12px; padding: 0.8rem 1rem; }
}

/* ==================== LANDSCAPE MOBILE ==================== */
@media (max-height: 500px) and (orientation: landscape) {
  .game-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr auto;
    gap: 0.4rem;
    padding: 0.4rem;
  }

  .right-panel { display: contents; }
  .incubator-area { order: 1; grid-row: 1 / 3; }
  .vitals-monitor { order: 2; }
  .diagnosis-panel { order: 3; position: static; padding: 0.4rem; }

  .incubator-frame { min-height: 160px; }
  .baby-wrapper { width: 45%; }
  .clue-list { max-height: 100px; }
  .feedback-card { max-height: 95vh; }
}
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="title-screen">
  <div class="title-badge">NICU Education</div>
  <h1 class="title-main">
    æ—©ç”¢å…’åˆä½µç—‡<br><span class="highlight">è‡¨åºŠè©•ä¼°æ¨¡æ“¬å™¨</span>
  </h1>
  <p class="title-sub">
    è§€å¯Ÿä¿æº«ç®±ä¸­æ—©ç”¢å…’çš„è‡¨åºŠè¡¨ç¾ï¼Œ<br>
    é»æ“Šèº«é«”å„éƒ¨ä½æ”¶é›†ç·šç´¢ï¼Œåšå‡ºæ­£ç¢ºçš„è¨ºæ–·åˆ¤æ–·ã€‚
  </p>
  <div class="title-conditions">
    <div class="condition-tag">å‘¼å¸çª˜è¿«ç—‡å€™ç¾¤ RDS</div>
    <div class="condition-tag">é–‹æ”¾æ€§å‹•è„ˆå°ç®¡ PDA</div>
    <div class="condition-tag">è…¦å®¤å…§å‡ºè¡€ IVH</div>
    <div class="condition-tag">å£æ­»æ€§è…¸ç‚ NEC</div>
    <div class="condition-tag">æ—©ç”¢å…’è¦–ç¶²è†œç—…è®Š ROP</div>
  </div>
  <button class="btn-start" onclick="startGame()">é–‹å§‹æ¨¡æ“¬è©•ä¼°</button>
  <div class="copyright-footer">
    <a href="https://yi-hung-lee.work/" target="_blank" rel="noopener noreferrer">&copy; 2026 æå¥•å®. All Rights Reserved.</a>
  </div>
</div>

<!-- TUTORIAL OVERLAY -->
<div class="tutorial-overlay" id="tutorial-overlay">
  <div class="tutorial-card">
    <h2>éŠæˆ²èªªæ˜</h2>
    <div class="tutorial-steps-wrapper">
      <div class="tutorial-step active" data-step="0">
        <div class="tutorial-step-icon">ğŸ”</div>
        <h3>æ­¥é©Ÿä¸€ï¼šè§€å¯Ÿå¯¶å¯¶</h3>
        <p>é»æ“Šä¿æº«ç®±ä¸­å¯¶å¯¶çš„<strong>é ­éƒ¨ã€è‡‰éƒ¨ã€èƒ¸éƒ¨ã€è…¹éƒ¨ã€å››è‚¢</strong>åŠ<strong>ç—…æ­·ç´€éŒ„</strong>ä¾†é€²è¡Œè‡¨åºŠè§€å¯Ÿ</p>
      </div>
      <div class="tutorial-step" data-step="1">
        <div class="tutorial-step-icon">ğŸ“‹</div>
        <h3>æ­¥é©ŸäºŒï¼šæ”¶é›†ç·šç´¢</h3>
        <p>æ¯å€‹éƒ¨ä½éƒ½æœƒæä¾›ä¸åŒçš„è‡¨åºŠè§€å¯Ÿçµæœï¼Œä»”ç´°é–±è®€ä¸¦æ³¨æ„<strong>ç•°å¸¸ç™¼ç¾</strong></p>
      </div>
      <div class="tutorial-step" data-step="2">
        <div class="tutorial-step-icon">ğŸ©º</div>
        <h3>æ­¥é©Ÿä¸‰ï¼šåšå‡ºè¨ºæ–·</h3>
        <p>æ ¹æ“šæ”¶é›†åˆ°çš„ç·šç´¢ï¼Œåœ¨<strong>60 ç§’</strong>å…§å¾äº”ç¨®æ—©ç”¢å…’åˆä½µç—‡ä¸­é¸æ“‡æ­£ç¢ºçš„è¨ºæ–·</p>
      </div>
    </div>
    <div class="tutorial-dots">
      <span class="dot active"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
    <div class="tutorial-actions">
      <label class="tutorial-skip">
        <input type="checkbox" id="tutorial-skip-check">
        <span>ä¸‹æ¬¡ä¸å†é¡¯ç¤º</span>
      </label>
      <button class="tutorial-btn" id="tutorial-btn" onclick="handleTutorialAction()">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>
</div>

<!-- GAME SCREEN -->
<div id="game-screen">
  <div class="top-bar">
    <div class="round-info">
      <span class="round-label" id="round-label">CASE 1 / 5</span>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill" style="width: 20%"></div>
      </div>
    </div>
    <div class="timer-container" id="timer-container">
      <svg class="timer-svg" viewBox="0 0 36 36">
        <circle class="timer-track" cx="18" cy="18" r="15.5"/>
        <circle class="timer-progress" id="timer-progress" cx="18" cy="18" r="15.5"/>
      </svg>
      <span class="timer-text" id="timer-text">60</span>
    </div>
    <div class="score-display">
      <span class="score-icon">&#9733;</span>
      <span class="score-val" id="score-val">0</span>
    </div>
  </div>

  <div class="game-layout">
    <!-- Clues container: bottom sheet on mobile, sidebar on desktop -->
    <div class="clues-container" id="clues-container">
      <div class="sheet-handle"></div>
      <div class="clues-header">
        <span class="clues-title">ğŸ“‹ è‡¨åºŠè§€å¯Ÿç´€éŒ„</span>
        <button class="clues-close-btn" onclick="toggleClues()">âœ•</button>
      </div>
      <div class="clue-instruction">
        é»æ“Šå¯¶å¯¶çš„<strong>é ­éƒ¨ã€è‡‰éƒ¨ã€èƒ¸éƒ¨ã€è…¹éƒ¨ã€å››è‚¢</strong>æˆ–<strong>ç—…æ­·ç´€éŒ„</strong>ä¾†æ”¶é›†è‡¨åºŠç·šç´¢ã€‚
      </div>
      <div class="clue-list" id="clue-list"></div>
    </div>

    <!-- Center: Incubator -->
    <div class="incubator-area">
      <div class="incubator-frame">
        <div class="incubator-label">INCUBATOR â€” NICU BED #<span id="bed-num">3</span></div>
        <div class="incubator-temp" id="incubator-temp">34.2Â°C</div>

        <div class="baby-wrapper" id="baby-wrapper">
          <img class="baby-base" src="https://raw.githubusercontent.com/NICUgame/premature-infant-game/refs/heads/main/%E6%97%A9%E7%94%A2%E5%85%92.png" alt="æ—©ç”¢å…’">

          <!-- Symptom overlays -->
          <div class="overlay-chest-retract"></div>
          <div class="overlay-nasal-flare"></div>
          <div class="overlay-grunt-waves">
            <div class="grunt-wave"></div>
            <div class="grunt-wave"></div>
            <div class="grunt-wave"></div>
          </div>
          <div class="overlay-heart-pulse"></div>
          <div class="overlay-bounding-pulse" style="position:absolute;top:44%;left:2%;width:96%;height:10%;">
            <div class="bounding-dot left-wrist"></div>
            <div class="bounding-dot right-wrist"></div>
          </div>
          <div class="overlay-murmur">
            <div class="murmur-line"></div>
            <div class="murmur-line"></div>
            <div class="murmur-line"></div>
          </div>
          <div class="overlay-fontanelle"></div>
          <div class="overlay-abdomen-distend"></div>
          <div class="overlay-blood-spot"></div>
          <div class="overlay-eye-hint"></div>

          <!-- Clickable hotspot zones -->
          <div class="hotspot-zone zone-head" data-zone="head" title="é ­éƒ¨"></div>
          <div class="hotspot-zone zone-face" data-zone="face" title="è‡‰éƒ¨"></div>
          <div class="hotspot-zone zone-chest" data-zone="chest" title="èƒ¸éƒ¨"></div>
          <div class="hotspot-zone zone-abdomen" data-zone="abdomen" title="è…¹éƒ¨"></div>
          <div class="hotspot-zone zone-limbs" data-zone="limbs" title="å››è‚¢"></div>
          <div class="hotspot-zone zone-monitor" data-zone="monitor" title="ç—…æ­·/è½è¨º">
            <svg viewBox="0 0 20 20" width="14" height="14" fill="none" stroke="var(--accent-blue)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;opacity:0.7;">
              <rect x="4" y="2" width="12" height="16" rx="2"/>
              <path d="M7 1v3M13 1v3M8 9h4M8 12h3"/>
            </svg>
            <span>ç—…æ­·</span>
          </div>
        </div>
      </div>

      <div class="prompt-bar">
        <p class="prompt-text" id="prompt-text">é»æ“Šå¯¶å¯¶çš„å„å€‹éƒ¨ä½é€²è¡Œè‡¨åºŠè§€å¯Ÿ</p>
        <button class="clue-toggle-btn" id="clue-toggle" onclick="toggleClues()">
          ğŸ“‹ ç·šç´¢ <span id="clue-count-badge">0</span>/6
        </button>
      </div>
    </div>

    <!-- Right: Vitals & Diagnosis -->
    <div class="right-panel">
      <div class="vitals-monitor">
        <div class="vitals-header">
          <span class="dot"></span>
          PATIENT MONITOR
        </div>
        <div class="waveform-container">
          <canvas class="waveform-canvas" id="waveform-canvas"></canvas>
        </div>
        <div id="vitals-rows"></div>
      </div>

      <div class="diagnosis-panel">
        <div class="panel-header">
          <svg viewBox="0 0 16 16" width="14" height="14" fill="var(--accent-blue)"><path d="M8 0l2 5h5l-4 3.5 1.5 5L8 10.5 3.5 13.5 5 8.5 1 5h5z"/></svg>
          é¸æ“‡è¨ºæ–·
        </div>
        <div id="diagnosis-buttons"></div>
        <div class="submit-hint" id="submit-hint">æ”¶é›†ç·šç´¢å¾Œé¸æ“‡ä½ çš„è¨ºæ–·</div>
      </div>
    </div>
  </div>
</div>

<!-- CLUE BACKDROP -->
<div class="clue-backdrop" id="clue-backdrop" onclick="toggleClues()"></div>

<!-- FEEDBACK OVERLAY -->
<div class="feedback-overlay" id="feedback-overlay">
  <div class="feedback-card">
    <div class="feedback-icon" id="feedback-icon"></div>
    <div class="feedback-title" id="feedback-title"></div>
    <div class="feedback-answer" id="feedback-answer"></div>
    <div class="feedback-explanation" id="feedback-explanation"></div>
    <button class="btn-next" id="btn-next" onclick="nextRound()">ä¸‹ä¸€é¡Œ</button>
  </div>
</div>

<!-- RESULTS SCREEN -->
<div id="results-screen">
  <div class="results-card">
    <h2 style="font-size:0.9rem;color:var(--text-dim);margin-bottom:1.2rem;letter-spacing:1px;">è©•ä¼°çµæœ</h2>
    <div class="results-score-circle" id="results-circle">
      <span class="big-num" id="results-big"></span>
      <span class="of-total">/ 5</span>
    </div>
    <div class="results-message" id="results-message"></div>
    <div class="results-detail" id="results-detail"></div>
    <div class="results-breakdown" id="results-breakdown"></div>
    <button class="btn-restart" onclick="restartGame()">å†æ¬¡æŒ‘æˆ°</button>
  </div>
</div>

<script>
// ==================== GAME DATA ====================
var CONDITIONS = [
  {
    id: 'rds',
    name: 'å‘¼å¸çª˜è¿«ç—‡å€™ç¾¤ (RDS)',
    nameShort: 'RDS',
    vitals: {
      hr:   { value: '168', status: 'warning', label: 'HR' },
      spo2: { value: '83',  status: 'danger',  label: 'SpO2' },
      rr:   { value: '74',  status: 'danger',  label: 'RR' },
      bp:   { value: '38/22', status: 'warning', label: 'BP' },
      temp: { value: '36.5', status: 'normal',  label: 'TEMP' }
    },
    waveformStyle: 'tachypneic',
    hotspots: {
      chest:   { label: 'èƒ¸éƒ¨è§€å¯Ÿ', text: 'å¸æ°£æ™‚å¯è¦‹èƒ¸å£æ˜é¡¯å‡¹é™·ï¼Œè‚‹é–“åŠèƒ¸éª¨ä¸‹æ–¹å‡ºç¾å‡¹é™·ç¾è±¡ï¼Œå‘¼å¸ä¼¼ä¹ç›¸ç•¶è²»åŠ›ã€‚' },
      face:    { label: 'é¢éƒ¨è§€å¯Ÿ', text: 'é¼»å­”éš¨è‘—æ¯æ¬¡å‘¼å¸æœ‰äº›å¾®æ“´å¼µçš„è·¡è±¡ã€‚å˜´å”‡é¡è‰²ä¼¼ä¹åæš—ï¼Œä¸å¤ªç´…æ½¤ã€‚' },
      head:    { label: 'é ­éƒ¨è§¸è¨º', text: 'å‰å›Ÿé–€å¹³å¦æŸ”è»Ÿï¼Œè§¸è¨ºç„¡ç•°å¸¸ç™¼ç¾ã€‚' },
      abdomen: { label: 'è…¹éƒ¨è§€å¯Ÿ', text: 'è…¹éƒ¨å¤–è§€æŸ”è»Ÿï¼Œç„¡æ˜é¡¯è†¨è„¹ã€‚è…¸éŸ³æ­£å¸¸ã€‚' },
      limbs:   { label: 'å››è‚¢è§€å¯Ÿ', text: 'å››è‚¢æœ«æ¢¢é¡è‰²ç•¥é¡¯æš—æ·¡ã€‚è‚Œå¼µåŠ›å°šå¯ï¼Œæœ‰è‡ªç™¼æ€§æ´»å‹•ã€‚' },
      monitor: { label: 'è½è¨º / ç›£æ¸¬', text: 'å‘¼æ°£æ™‚å¯è½åˆ°å¾®å¼±çš„ã€Œå—¯â€¦å—¯â€¦ã€è²éŸ¿ã€‚å¿ƒéŸ³è¦å‰‡ï¼Œç„¡æ˜é¡¯é›œéŸ³ã€‚å‘¼å¸é »ç‡åå¿«ã€‚' }
    },
    explanation: 'æ­¤ç—…ä¾‹è¡¨ç¾ç‚ºå…¸å‹çš„<strong>å‘¼å¸çª˜è¿«ç—‡å€™ç¾¤ (RDS)</strong> ç‰¹å¾µï¼š<br><br>â€¢ <strong>ä¸‰å‡¹å¾µè±¡</strong>ï¼šå¸æ°£æ™‚èƒ¸éª¨ä¸Šå‡¹ã€è‚‹é–“å‡¹ã€åŠçªä¸‹å‡¹<br>â€¢ <strong>é¼»ç¿¼æ§å‹•</strong>ï¼šå¸æ°£æ™‚é¼»å­”æ“´å¼µ<br>â€¢ <strong>å‘»åŸè²</strong>ï¼šå‘¼æ°£æ™‚ç™¼å‡ºè²éŸ¿ï¼Œè©¦åœ–ç¶­æŒè‚ºæ³¡æ“´å¼µ<br>â€¢ <strong>ç™¼ç´º</strong>ï¼šå”‡è‰²èˆ‡æœ«æ¢¢åæš—ï¼ŒSpO2 åä½<br><br>RDS å› è‚ºæ³¡è¡¨é¢å¼µåŠ›ç´ ä¸è¶³æ‰€è‡´ï¼Œå¸¸è¦‹æ–¼æ—©ç”¢å…’å‡ºç”Ÿå¾Œæ•¸å°æ™‚å…§ã€‚'
  },
  {
    id: 'pda',
    name: 'é–‹æ”¾æ€§å‹•è„ˆå°ç®¡ (PDA)',
    nameShort: 'PDA',
    vitals: {
      hr:   { value: '162', status: 'warning', label: 'HR' },
      spo2: { value: '91',  status: 'warning', label: 'SpO2' },
      rr:   { value: '58',  status: 'warning', label: 'RR' },
      bp:   { value: '62/25', status: 'danger', label: 'BP' },
      temp: { value: '36.8', status: 'normal',  label: 'TEMP' }
    },
    waveformStyle: 'bounding',
    hotspots: {
      chest:   { label: 'èƒ¸éƒ¨è§€å¯Ÿ', text: 'èƒ¸å£å¯è¦‹æå‹•æ¯”é æœŸæ˜é¡¯ã€‚æœªè¦‹é¡¯è‘—ä¸‰å‡¹å¾µè±¡ï¼Œä½†å‘¼å¸ç•¥é¡¯æ€¥ä¿ƒã€‚' },
      face:    { label: 'é¢éƒ¨è§€å¯Ÿ', text: 'é¢è‰²å°šå¯ï¼Œç„¡æ˜é¡¯ç™¼ç´ºã€‚å¶æœ‰è¼•å¾®å‘¼å¸è²»åŠ›çš„è¡¨ç¾ã€‚' },
      head:    { label: 'é ­éƒ¨è§¸è¨º', text: 'å‰å›Ÿé–€å¹³å¦æŸ”è»Ÿï¼Œç„¡éš†èµ·ã€‚é ­éƒ¨å¤–è§€æ­£å¸¸ã€‚' },
      abdomen: { label: 'è…¹éƒ¨è§€å¯Ÿ', text: 'è…¹éƒ¨æŸ”è»Ÿï¼Œä½†æ³¨æ„åˆ°è…¹ä¸»å‹•è„ˆæå‹•ä¼¼ä¹è¼ƒç‚ºæ˜é¡¯ã€‚é¤µé£Ÿç‹€æ³å°šå¯ã€‚' },
      limbs:   { label: 'å››è‚¢è§€å¯Ÿ', text: 'å‘¨é‚Šè„ˆæè·³å‹•æœ‰åŠ›ï¼Œæ„Ÿè¦ºè¼ƒä¸€èˆ¬æ—©ç”¢å…’æ˜é¡¯ã€‚è†šè‰²æ­£å¸¸ï¼Œæº«æš–ã€‚' },
      monitor: { label: 'è½è¨º / ç›£æ¸¬', text: 'å·¦èƒ¸éª¨ä¸Šç·£å¯è½åˆ°é€£çºŒæ€§é›œéŸ³ï¼Œåƒæ˜¯æŒçºŒæ€§çš„æ©Ÿæ¢°é‹è½‰è²ã€‚è„ˆå£“å·®ä¼¼ä¹åå¤§ï¼ˆæ”¶ç¸®å£“èˆ‡èˆ’å¼µå£“å·®è·å¤§ï¼‰ã€‚' }
    },
    explanation: 'æ­¤ç—…ä¾‹è¡¨ç¾ç‚º<strong>é–‹æ”¾æ€§å‹•è„ˆå°ç®¡ (PDA)</strong> çš„ç‰¹å¾µï¼š<br><br>â€¢ <strong>é€£çºŒæ€§å¿ƒé›œéŸ³</strong>ï¼šå·¦èƒ¸éª¨ä¸Šç·£è½åˆ°ä¼¼æ©Ÿå™¨é‹è½‰çš„é›œéŸ³<br>â€¢ <strong>è„ˆå£“å·®å¢å¤§</strong>ï¼šBP 62/25ï¼Œæ”¶ç¸®å£“èˆ‡èˆ’å¼µå£“å·®è·æ˜é¡¯<br>â€¢ <strong>å‘¨é‚Šè„ˆææœ‰åŠ›ï¼ˆè·³è„ˆï¼‰</strong>ï¼šå‹•è„ˆå°ç®¡åˆ†æµå°è‡´<br>â€¢ <strong>èƒ¸å£æå‹•æ˜é¡¯</strong>ï¼šå¿ƒè‡Ÿè² è·å¢åŠ <br><br>PDA æ˜¯å› å‡ºç”Ÿå¾Œå‹•è„ˆå°ç®¡æœªé—œé–‰ï¼Œè¡€æ¶²å¾ä¸»å‹•è„ˆç¶“å°ç®¡æµå‘è‚ºå‹•è„ˆæ‰€è‡´ã€‚'
  },
  {
    id: 'ivh',
    name: 'è…¦å®¤å…§å‡ºè¡€ (IVH)',
    nameShort: 'IVH',
    vitals: {
      hr:   { value: '138', status: 'warning', label: 'HR' },
      spo2: { value: '88',  status: 'warning', label: 'SpO2' },
      rr:   { value: '42',  status: 'normal',  label: 'RR' },
      bp:   { value: '30/18', status: 'danger', label: 'BP' },
      temp: { value: '36.0', status: 'warning', label: 'TEMP' }
    },
    waveformStyle: 'irregular',
    hotspots: {
      head:    { label: 'é ­éƒ¨è§¸è¨º', text: 'å‰å›Ÿé–€è§¸æ‘¸èµ·ä¾†ä¼¼ä¹æœ‰äº›é£½æ»¿å¼µåŠ›ï¼Œç•¥æœ‰éš†èµ·çš„æ„Ÿè¦ºã€‚é ­åœéœ€è¦å¯†åˆ‡è¿½è¹¤ã€‚' },
      face:    { label: 'é¢éƒ¨è§€å¯Ÿ', text: 'å¯¶å¯¶è¡¨æƒ…å‘†æ»¯ï¼Œè†šè‰²è’¼ç™½ã€‚çœ¼ç¥ä¼¼ä¹ç¼ºä¹ç„¦é»ã€‚' },
      chest:   { label: 'èƒ¸éƒ¨è§€å¯Ÿ', text: 'å‘¼å¸å‹æ…‹ç›¸å°å¹³ç©©ï¼Œä½†å¶æœ‰å‘¼å¸æš«åœçš„ç¾è±¡å‡ºç¾ã€‚å¿ƒéŸ³è¦å‰‡ã€‚' },
      abdomen: { label: 'è…¹éƒ¨è§€å¯Ÿ', text: 'è…¹éƒ¨æŸ”è»Ÿå¹³å¦ï¼Œç„¡ç•°å¸¸ç™¼ç¾ã€‚' },
      limbs:   { label: 'å››è‚¢è§€å¯Ÿ', text: 'è‚Œå¼µåŠ›æ˜é¡¯ä¸‹é™ï¼Œå››è‚¢è»Ÿè¶´è¶´åœ°æ”¤åœ¨åºŠé¢ä¸Šã€‚å¶çˆ¾å‡ºç¾çŸ­æš«ä¸è‡ªä¸»çš„æŠ½å‹•ã€‚' },
      monitor: { label: 'è½è¨º / ç›£æ¸¬', text: 'è¡€å£“åä½ã€‚è¿‘æœŸæŠ½è¡€å ±å‘Šé¡¯ç¤ºè¡€è‰²ç´ æœ‰ä¸‹é™è¶¨å‹¢ã€‚æ•´é«”æ´»åŠ›çªç„¶è®Šå·®ã€‚' }
    },
    explanation: 'æ­¤ç—…ä¾‹è¡¨ç¾ç‚º<strong>è…¦å®¤å…§å‡ºè¡€ (IVH)</strong> çš„ç‰¹å¾µï¼š<br><br>â€¢ <strong>å‰å›Ÿé–€éš†èµ·</strong>ï¼šè…¦å£“å‡é«˜çš„å¾µå…†<br>â€¢ <strong>è‚Œå¼µåŠ›æ¶ˆå¤±</strong>ï¼šè®Šå¾—è»Ÿè¶´è¶´<br>â€¢ <strong>æŠ½æè¡¨ç¾</strong>ï¼šçŸ­æš«ä¸è‡ªä¸»æŠ½å‹•<br>â€¢ <strong>è’¼ç™½ / è²§è¡€</strong>ï¼šè¡€è‰²ç´ ä¸‹é™<br>â€¢ <strong>è¡€å£“åä½</strong>ï¼šå¯èƒ½å‡ºç¾ä¼‘å…‹è¡¨ç¾<br><br>IVH å¸¸ç™¼ç”Ÿåœ¨æ¥µæ—©ç”¢å…’å‡ºç”Ÿå¾Œæœ€åˆå¹¾å¤©ï¼Œæºæ–¼è…¦å®¤å‘¨åœè„†å¼±çš„è¡€ç®¡ç ´è£‚å‡ºè¡€ã€‚'
  },
  {
    id: 'nec',
    name: 'å£æ­»æ€§è…¸ç‚ (NEC)',
    nameShort: 'NEC',
    vitals: {
      hr:   { value: '175', status: 'danger',  label: 'HR' },
      spo2: { value: '90',  status: 'warning', label: 'SpO2' },
      rr:   { value: '65',  status: 'warning', label: 'RR' },
      bp:   { value: '35/20', status: 'danger', label: 'BP' },
      temp: { value: '35.8', status: 'danger',  label: 'TEMP' }
    },
    waveformStyle: 'tachycardic',
    hotspots: {
      abdomen: { label: 'è…¹éƒ¨è§€å¯Ÿ', text: 'è…¹éƒ¨çœ‹èµ·ä¾†é¼“è„¹ç™¼äº®ï¼Œè¼•è§¸å³æœ‰å¼µåŠ›æ„Ÿã€‚è…¹å£çš®è†šé¡è‰²ä¼¼ä¹ä¸å¤ªå‡å‹»ï¼Œæœ‰äº›å€åŸŸå¾®å¾®ç™¼ç´…ã€‚' },
      face:    { label: 'é¢éƒ¨è§€å¯Ÿ', text: 'å¯¶å¯¶è¡¨æƒ…ç—›è‹¦ï¼Œé¡¯å¾—å—œç¡ä¸”æ´»åŠ›ä¸ä½³ã€‚è†šè‰²åç°ã€‚' },
      head:    { label: 'é ­éƒ¨è§¸è¨º', text: 'å‰å›Ÿé–€å¹³å¦ï¼Œç„¡ç•°å¸¸éš†èµ·ã€‚' },
      chest:   { label: 'èƒ¸éƒ¨è§€å¯Ÿ', text: 'å‘¼å¸ç•¥ç‚ºæ€¥ä¿ƒï¼Œå¶æœ‰çŸ­æš«çš„å‘¼å¸æš«åœç¾è±¡ã€‚å¿ƒéŸ³è¦å‰‡ä½†åå¿«ã€‚' },
      limbs:   { label: 'å››è‚¢è§€å¯Ÿ', text: 'å››è‚¢æ´»å‹•æ¸›å°‘ï¼Œæ•´é«”é¡¯å¾—å—œç¡ã€‚æœ«æ¢¢å¾ªç’°ç•¥å·®ã€‚' },
      monitor: { label: 'é¤µé£Ÿ / ç›£æ¸¬ç´€éŒ„', text: 'èƒƒç®¡åæŠ½æ¶²é¡è‰²åç¶ ï¼ˆå¸¶è†½æ±ï¼‰ï¼Œé‡æ¯”å‰å¹¾æ¬¡å¢å¤šã€‚è­·ç†ç´€éŒ„è¨˜è¼‰æœ€è¿‘ä¸€æ¬¡å¤§ä¾¿å¸¶æœ‰è¡€çµ²ã€‚é«”æº«ä¸ç©©å®šã€‚' }
    },
    explanation: 'æ­¤ç—…ä¾‹è¡¨ç¾ç‚º<strong>å£æ­»æ€§è…¸ç‚ (NEC)</strong> çš„ç‰¹å¾µï¼š<br><br>â€¢ <strong>è…¹è„¹</strong>ï¼šè…¹éƒ¨æ˜é¡¯é¼“è„¹ã€ç™¼äº®<br>â€¢ <strong>é¤µé£Ÿä¸è€</strong>ï¼šèƒƒç®¡åæŠ½ç‰©å¢å¤šä¸”å¸¶æœ‰è†½æ±ï¼ˆç¶ è‰²ï¼‰<br>â€¢ <strong>è¡€ä¾¿</strong>ï¼šå¤§ä¾¿å¸¶æœ‰è¡€çµ²<br>â€¢ <strong>æ´»åŠ›ä¸‹é™</strong>ï¼šå—œç¡ã€é«”æº«ä¸ç©©<br>â€¢ <strong>ç”Ÿå‘½å¾µè±¡ä¸ç©©</strong>ï¼šå¿ƒè·³åå¿«ã€é«”æº«åä½<br><br>NEC æ˜¯æ—©ç”¢å…’åš´é‡çš„è…¸é“ä½µç™¼ç—‡ï¼Œè…¸å£ç¼ºè¡€å£æ­»å¯å°è‡´ç©¿å­”åŠæ•—è¡€ç—‡ã€‚'
  },
  {
    id: 'rop',
    name: 'æ—©ç”¢å…’è¦–ç¶²è†œç—…è®Š (ROP)',
    nameShort: 'ROP',
    vitals: {
      hr:   { value: '148', status: 'normal', label: 'HR' },
      spo2: { value: '95',  status: 'normal', label: 'SpO2' },
      rr:   { value: '48',  status: 'normal', label: 'RR' },
      bp:   { value: '45/28', status: 'normal', label: 'BP' },
      temp: { value: '36.7', status: 'normal', label: 'TEMP' }
    },
    waveformStyle: 'normal',
    hotspots: {
      face:    { label: 'çœ¼éƒ¨è§€å¯Ÿ', text: 'å¯¶å¯¶çš„çœ¼ç›å¤–è§€ç„¡æ˜é¡¯ç•°å¸¸ï¼Œä½†è€ƒé‡å…¶èƒé½¡èˆ‡éå»çš„é«˜æ¿ƒåº¦æ°§æ°£ä½¿ç”¨ç´€éŒ„ï¼Œéœ€å®‰æ’çœ¼ç§‘æª¢æŸ¥ã€‚' },
      head:    { label: 'é ­éƒ¨è§¸è¨º', text: 'å‰å›Ÿé–€å¹³å¦ã€‚é ­éƒ¨ç™¼è‚²æ­£å¸¸ã€‚' },
      chest:   { label: 'èƒ¸éƒ¨è§€å¯Ÿ', text: 'å‘¼å¸å¹³ç©©è¦å‰‡ï¼Œç›®å‰å·²è„«é›¢å‘¼å¸å™¨ä½†ä»æœ‰ä½¿ç”¨æ°§æ°£çš„ç—…å²ç´€éŒ„ã€‚' },
      abdomen: { label: 'è…¹éƒ¨è§€å¯Ÿ', text: 'è…¹éƒ¨æŸ”è»Ÿï¼Œé¤µé£Ÿè‰¯å¥½ï¼Œç„¡ç•°å¸¸ã€‚' },
      limbs:   { label: 'å››è‚¢è§€å¯Ÿ', text: 'å››è‚¢æ´»å‹•æ­£å¸¸ï¼Œè‚Œå¼µåŠ›é©ç•¶ã€‚æ•´é«”æ´»åŠ›è‰¯å¥½ã€‚' },
      monitor: { label: 'ç—…æ­· / æª¢æŸ¥ç´€éŒ„', text: 'ç—…æ­·è¨˜è¼‰ï¼šå‡ºç”Ÿé€±æ•¸28é€±ï¼Œæ›¾é•·æœŸä½¿ç”¨é«˜æ¿ƒåº¦æ°§æ°£ã€‚çœ¼ç§‘æœƒè¨ºç´€éŒ„ï¼šé–“æ¥çœ¼åº•é¡æª¢æŸ¥ç™¼ç¾è¦–ç¶²è†œå‘¨é‚Šè¡€ç®¡ç™¼è‚²ä¸å®Œå…¨ï¼Œæœ‰ç•°å¸¸æ–°ç”Ÿè¡€ç®¡å¢ç”Ÿç·šã€‚' }
    },
    explanation: 'æ­¤ç—…ä¾‹ç‚º<strong>æ—©ç”¢å…’è¦–ç¶²è†œç—…è®Š (ROP)</strong>ï¼š<br><br>â€¢ <strong>ç”Ÿå‘½å¾µè±¡ç©©å®š</strong>ï¼šç›®å‰ç„¡æ€¥æ€§ç—‡ç‹€<br>â€¢ <strong>é«˜é¢¨éšªå› å­</strong>ï¼šæ¥µæ—©ç”¢ï¼ˆ28é€±ï¼‰ã€é•·æœŸé«˜æ¿ƒåº¦æ°§æ°£ä½¿ç”¨<br>â€¢ <strong>çœ¼åº•æª¢æŸ¥ç•°å¸¸</strong>ï¼šè¦–ç¶²è†œè¡€ç®¡ç™¼è‚²ä¸å®Œå…¨ã€ç•°å¸¸æ–°ç”Ÿè¡€ç®¡å¢ç”Ÿ<br>â€¢ <strong>å¤–è§€ç„¡æ˜é¡¯ç•°å¸¸</strong>ï¼šéœ€é çœ¼ç§‘å°ˆç§‘æª¢æŸ¥æ‰èƒ½è¨ºæ–·<br><br>ROP å› æ—©ç”¢å…’è¦–ç¶²è†œè¡€ç®¡å°šæœªæˆç†Ÿï¼Œå—æ°§æ°£ç­‰å› ç´ åˆºæ¿€å°è‡´ç•°å¸¸å¢ç”Ÿï¼Œåš´é‡å¯è‡´å¤±æ˜ã€‚ç¯©æª¢æ˜¯é—œéµã€‚'
  }
];

var DIAGNOSIS_OPTIONS = [
  { id: 'rds', label: 'å‘¼å¸çª˜è¿«ç—‡å€™ç¾¤ (RDS)' },
  { id: 'pda', label: 'é–‹æ”¾æ€§å‹•è„ˆå°ç®¡ (PDA)' },
  { id: 'ivh', label: 'è…¦å®¤å…§å‡ºè¡€ (IVH)' },
  { id: 'nec', label: 'å£æ­»æ€§è…¸ç‚ (NEC)' },
  { id: 'rop', label: 'æ—©ç”¢å…’è¦–ç¶²è†œç—…è®Š (ROP)' }
];

// ==================== GAME STATE ====================
var gameState = {
  currentRound: 0,
  score: 0,
  order: [],
  discoveredClues: {},
  results: [],
  answered: false
};

// ==================== TIMER ====================
var TIMER_TOTAL = 60;
var timerInterval = null;
var timerSeconds = TIMER_TOTAL;
var timerCircumference = 2 * Math.PI * 15.5; // ~97.389

function startTimer() {
  timerSeconds = TIMER_TOTAL;
  updateTimerDisplay();

  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(function() {
    timerSeconds--;
    updateTimerDisplay();

    if (timerSeconds <= 0) {
      clearInterval(timerInterval);
      timerInterval = null;
      timeUp();
    }
  }, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function updateTimerDisplay() {
  var container = document.getElementById('timer-container');
  var progress = document.getElementById('timer-progress');
  var text = document.getElementById('timer-text');

  var offset = timerCircumference * (1 - timerSeconds / TIMER_TOTAL);
  progress.style.strokeDashoffset = offset;
  text.textContent = timerSeconds;

  container.classList.remove('warning', 'danger');
  if (timerSeconds <= 10) {
    container.classList.add('danger');
  } else if (timerSeconds <= 20) {
    container.classList.add('warning');
  }
}

function timeUp() {
  if (gameState.answered) return;
  gameState.answered = true;

  var condition = CONDITIONS[gameState.order[gameState.currentRound]];

  gameState.results.push({
    condition: condition,
    selectedId: null,
    correct: false
  });

  var btns = document.querySelectorAll('.diagnosis-btn');
  for (var i = 0; i < btns.length; i++) {
    btns[i].disabled = true;
    if (btns[i].getAttribute('data-id') === condition.id) {
      btns[i].classList.add('correct');
    }
  }

  setTimeout(function() {
    showFeedback(false, condition, null, true);
  }, 400);
}

// ==================== TUTORIAL ====================
var tutorialStep = 0;

function showTutorial() {
  tutorialStep = 0;
  updateTutorialStep();
  document.getElementById('tutorial-overlay').classList.add('active');
}

function updateTutorialStep() {
  var steps = document.querySelectorAll('.tutorial-step');
  var dots = document.querySelectorAll('.tutorial-dots .dot');
  var btn = document.getElementById('tutorial-btn');

  for (var i = 0; i < steps.length; i++) {
    steps[i].classList.toggle('active', i === tutorialStep);
    dots[i].classList.toggle('active', i === tutorialStep);
  }

  btn.textContent = tutorialStep === 2 ? 'é–‹å§‹éŠæˆ²' : 'ä¸‹ä¸€æ­¥';
}

function handleTutorialAction() {
  if (tutorialStep < 2) {
    tutorialStep++;
    updateTutorialStep();
  } else {
    if (document.getElementById('tutorial-skip-check').checked) {
      localStorage.setItem('nicu_skip_tutorial', 'true');
    }
    document.getElementById('tutorial-overlay').classList.remove('active');
    loadRound();
  }
}

// ==================== ECG WAVEFORM ====================
var waveformCtx, waveformAnim, waveformOffset = 0;

function initWaveform() {
  var canvas = document.getElementById('waveform-canvas');
  if (!canvas) return;
  var container = canvas.parentElement;
  if (!container || container.offsetWidth === 0) return;
  var rect = container.getBoundingClientRect();
  canvas.width = rect.width * 2;
  canvas.height = rect.height * 2;
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
  waveformCtx = canvas.getContext('2d');
  waveformCtx.scale(2, 2);
}

function generateBeat(cycleLen, amplitude, style) {
  var pts = [];
  var a = amplitude;
  var pre = 0.08, p = 0.08, pr = 0.06, qrs = 0.10, st = 0.10, t = 0.12;

  function addFlat(s, e, yOff) {
    var x0 = Math.round(s * cycleLen), x1 = Math.round(e * cycleLen);
    for (var x = x0; x < x1; x++) pts.push(yOff || 0);
  }

  function addBump(s, e, h) {
    var x0 = Math.round(s * cycleLen), x1 = Math.round(e * cycleLen), len = x1 - x0;
    for (var i = 0; i < len; i++) pts.push(-h * Math.sin(Math.PI * i / len));
  }

  var pos = 0;
  addFlat(pos, pos + pre); pos += pre;

  var pH = a * (style === 'irregular' ? 0.08 : 0.12);
  addBump(pos, pos + p, pH); pos += p;

  addFlat(pos, pos + pr); pos += pr;

  var qS = Math.round(pos * cycleLen), qE = Math.round((pos + qrs) * cycleLen), qLen = qE - qS;
  for (var i = 0; i < qLen; i++) {
    var tt = i / qLen, y = 0;
    if (tt < 0.2) {
      y = (a * 0.15) * Math.sin(Math.PI * tt / 0.2);
    } else if (tt < 0.5) {
      var rH = a * (style === 'bounding' ? 1.15 : 0.9);
      y = -rH * Math.sin(Math.PI * (tt - 0.2) / 0.3);
    } else if (tt < 0.75) {
      y = (a * 0.25) * Math.sin(Math.PI * (tt - 0.5) / 0.25);
    }
    pts.push(y);
  }
  pos += qrs;

  var stOff = style === 'bounding' ? -a * 0.05 : 0;
  addFlat(pos, pos + st, stOff); pos += st;

  var tH = a * (style === 'bounding' ? 0.28 : 0.2);
  addBump(pos, pos + t, tH); pos += t;

  addFlat(pos, 1.0);
  return pts;
}

function drawWaveform(style) {
  if (!waveformCtx) return;
  var canvas = document.getElementById('waveform-canvas');
  var w = canvas.width / 2, h = canvas.height / 2, mid = h / 2;

  var cycleLen;
  switch (style) {
    case 'tachypneic':  cycleLen = 55; break;
    case 'bounding':    cycleLen = 60; break;
    case 'irregular':   cycleLen = 72; break;
    case 'tachycardic': cycleLen = 48; break;
    default:            cycleLen = 78; break;
  }

  var beat = generateBeat(cycleLen, h * 0.42, style);

  waveformCtx.clearRect(0, 0, w, h);
  waveformCtx.strokeStyle = '#5dadec';
  waveformCtx.lineWidth = 1.5;
  waveformCtx.beginPath();

  for (var x = 0; x < w; x++) {
    var shifted = x + waveformOffset;
    var idx;

    if (style === 'irregular') {
      var cycleNum = Math.floor(shifted / cycleLen);
      var jitter = Math.sin(cycleNum * 7.31) * 8;
      idx = Math.floor(((shifted + jitter) % cycleLen + cycleLen) % cycleLen);
    } else {
      idx = Math.floor(((shifted % cycleLen) + cycleLen) % cycleLen);
    }

    var y = mid + (idx < beat.length ? beat[idx] : 0);
    if (x === 0) waveformCtx.moveTo(x, y);
    else waveformCtx.lineTo(x, y);
  }

  waveformCtx.stroke();
  waveformCtx.strokeStyle = 'rgba(93,173,236,0.25)';
  waveformCtx.lineWidth = 4;
  waveformCtx.stroke();

  waveformOffset += 1.2;
  waveformAnim = requestAnimationFrame(function() { drawWaveform(style); });
}

// ==================== CLUE BOTTOM SHEET ====================
var cluesOpen = false;

function toggleClues() {
  cluesOpen = !cluesOpen;
  document.getElementById('clues-container').classList.toggle('open', cluesOpen);
  document.getElementById('clue-backdrop').classList.toggle('active', cluesOpen);
}

function closeClues() {
  cluesOpen = false;
  document.getElementById('clues-container').classList.remove('open');
  document.getElementById('clue-backdrop').classList.remove('active');
}

// ==================== GAME LOGIC ====================
function shuffleArray(arr) {
  var a = arr.slice();
  for (var i = a.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var tmp = a[i]; a[i] = a[j]; a[j] = tmp;
  }
  return a;
}

function startGame() {
  gameState = {
    currentRound: 0,
    score: 0,
    order: shuffleArray([0, 1, 2, 3, 4]),
    discoveredClues: {},
    results: [],
    answered: false
  };

  document.getElementById('title-screen').style.display = 'none';
  document.getElementById('results-screen').style.display = 'none';
  document.getElementById('game-screen').style.display = 'flex';

  initWaveform();

  if (localStorage.getItem('nicu_skip_tutorial') !== 'true') {
    showTutorial();
  } else {
    loadRound();
  }
}

function loadRound() {
  var round = gameState.currentRound;
  var condition = CONDITIONS[gameState.order[round]];

  gameState.discoveredClues = {};
  gameState.answered = false;

  document.getElementById('round-label').textContent = 'CASE ' + (round + 1) + ' / 5';
  document.getElementById('progress-fill').style.width = ((round + 1) * 20) + '%';
  document.getElementById('score-val').textContent = gameState.score;
  document.getElementById('bed-num').textContent = Math.floor(Math.random() * 12) + 1;
  document.getElementById('incubator-temp').textContent = (33 + Math.random() * 2).toFixed(1) + '\u00B0C';
  document.getElementById('clue-list').innerHTML = '';
  document.getElementById('prompt-text').textContent = 'é»æ“Šå¯¶å¯¶çš„å„å€‹éƒ¨ä½é€²è¡Œè‡¨åºŠè§€å¯Ÿ';
  document.getElementById('submit-hint').textContent = 'æ”¶é›†ç·šç´¢å¾Œé¸æ“‡ä½ çš„è¨ºæ–·';
  document.getElementById('clue-count-badge').textContent = '0';

  closeClues();

  var wrapper = document.getElementById('baby-wrapper');
  wrapper.className = 'baby-wrapper cond-' + condition.id;

  var zones = document.querySelectorAll('.hotspot-zone');
  for (var i = 0; i < zones.length; i++) {
    zones[i].classList.remove('discovered');
  }

  loadVitals(condition.vitals);

  if (waveformAnim) cancelAnimationFrame(waveformAnim);
  waveformOffset = 0;
  initWaveform();
  drawWaveform(condition.waveformStyle);

  loadDiagnosisButtons();
  startTimer();
}

function loadVitals(vitals) {
  var container = document.getElementById('vitals-rows');
  var units = { 'HR': 'bpm', 'SpO2': '%', 'RR': '/min', 'BP': 'mmHg', 'TEMP': '\u00B0C' };
  var html = '';
  var keys = Object.keys(vitals);
  for (var i = 0; i < keys.length; i++) {
    var v = vitals[keys[i]];
    html += '<div class="vital-row">' +
      '<span class="vital-label">' + v.label + '</span>' +
      '<span class="vital-value ' + v.status + '">' + v.value +
      '<span class="vital-unit">' + (units[v.label] || '') + '</span></span></div>';
  }
  container.innerHTML = html;
}

function discoverClue(zone) {
  if (gameState.discoveredClues[zone]) return;
  gameState.discoveredClues[zone] = true;

  var condition = CONDITIONS[gameState.order[gameState.currentRound]];
  var hotspot = condition.hotspots[zone];
  if (!hotspot) return;

  var zoneEl = document.querySelector('.hotspot-zone[data-zone="' + zone + '"]');
  if (zoneEl) zoneEl.classList.add('discovered');

  var clueList = document.getElementById('clue-list');
  var clueEl = document.createElement('div');
  clueEl.className = 'clue-item';
  clueEl.innerHTML = '<div class="clue-label">' + hotspot.label + '</div>' +
    '<div class="clue-text">' + hotspot.text + '</div>';
  clueList.appendChild(clueEl);
  clueList.scrollTop = clueList.scrollHeight;

  var count = Object.keys(gameState.discoveredClues).length;
  var remaining = 6 - count;
  document.getElementById('clue-count-badge').textContent = count;

  // Pulse the clue toggle button
  var toggleBtn = document.getElementById('clue-toggle');
  toggleBtn.classList.remove('has-new');
  void toggleBtn.offsetWidth;
  toggleBtn.classList.add('has-new');

  if (remaining > 0) {
    document.getElementById('prompt-text').textContent =
      'å·²ç™¼ç¾ ' + count + ' é …ç·šç´¢ï¼Œé‚„æœ‰ ' + remaining + ' å€‹å€åŸŸå¯æ¢ç´¢';
  } else {
    document.getElementById('prompt-text').textContent = 'æ‰€æœ‰å€åŸŸå·²æ¢ç´¢å®Œç•¢ï¼Œè«‹åšå‡ºè¨ºæ–·ï¼';
  }
}

function loadDiagnosisButtons() {
  var container = document.getElementById('diagnosis-buttons');
  var html = '';
  for (var i = 0; i < DIAGNOSIS_OPTIONS.length; i++) {
    var opt = DIAGNOSIS_OPTIONS[i];
    html += '<button class="diagnosis-btn" data-id="' + opt.id + '" onclick="selectDiagnosis(\'' + opt.id + '\')">' +
      '<span class="diag-num">' + (i + 1) + '</span>' + opt.label + '</button>';
  }
  container.innerHTML = html;
}

function selectDiagnosis(selectedId) {
  if (gameState.answered) return;
  gameState.answered = true;
  stopTimer();

  var condition = CONDITIONS[gameState.order[gameState.currentRound]];
  var isCorrect = selectedId === condition.id;
  if (isCorrect) gameState.score++;

  gameState.results.push({
    condition: condition,
    selectedId: selectedId,
    correct: isCorrect
  });

  var btns = document.querySelectorAll('.diagnosis-btn');
  for (var i = 0; i < btns.length; i++) {
    btns[i].disabled = true;
    if (btns[i].getAttribute('data-id') === condition.id) btns[i].classList.add('correct');
    else if (btns[i].getAttribute('data-id') === selectedId && !isCorrect) btns[i].classList.add('wrong');
  }

  setTimeout(function() { showFeedback(isCorrect, condition, selectedId, false); }, 600);
}

function showFeedback(isCorrect, condition, selectedId, isTimeout) {
  var overlay = document.getElementById('feedback-overlay');
  var icon = document.getElementById('feedback-icon');
  var title = document.getElementById('feedback-title');
  var answer = document.getElementById('feedback-answer');
  var explanation = document.getElementById('feedback-explanation');
  var btnNext = document.getElementById('btn-next');

  if (isTimeout) {
    icon.className = 'feedback-icon timeout';
    icon.textContent = '\u23F0';
    title.className = 'feedback-title timeout';
    title.textContent = 'æ™‚é–“åˆ°ï¼';
    answer.textContent = 'æ­£ç¢ºç­”æ¡ˆï¼š' + condition.name;
  } else {
    icon.className = 'feedback-icon ' + (isCorrect ? 'correct' : 'wrong');
    icon.textContent = isCorrect ? '\u2713' : '\u2717';
    title.className = 'feedback-title ' + (isCorrect ? 'correct' : 'wrong');
    title.textContent = isCorrect ? 'è¨ºæ–·æ­£ç¢ºï¼' : 'è¨ºæ–·æœ‰èª¤';
    answer.textContent = isCorrect ? condition.name : 'æ­£ç¢ºç­”æ¡ˆï¼š' + condition.name;
  }

  explanation.innerHTML = condition.explanation;
  btnNext.textContent = gameState.currentRound < 4 ? 'ä¸‹ä¸€é¡Œ' : 'æŸ¥çœ‹çµæœ';

  closeClues();
  overlay.classList.add('active');
}

function nextRound() {
  document.getElementById('feedback-overlay').classList.remove('active');
  gameState.currentRound++;
  if (gameState.currentRound >= 5) showResults();
  else loadRound();
}

function showResults() {
  document.getElementById('game-screen').style.display = 'none';
  document.getElementById('results-screen').style.display = 'flex';
  if (waveformAnim) cancelAnimationFrame(waveformAnim);
  stopTimer();

  var score = gameState.score;
  var circle = document.getElementById('results-circle');
  document.getElementById('results-big').textContent = score;

  if (score >= 4) {
    circle.className = 'results-score-circle excellent';
    document.getElementById('results-message').textContent = 'è¡¨ç¾å„ªç•°ï¼';
    document.getElementById('results-message').style.color = 'var(--accent-green)';
    document.getElementById('results-detail').textContent = 'ä½ å°æ—©ç”¢å…’åˆä½µç—‡çš„è‡¨åºŠè¾¨è­˜èƒ½åŠ›å¾ˆå¼·ï¼Œç¹¼çºŒä¿æŒï¼';
  } else if (score >= 3) {
    circle.className = 'results-score-circle good';
    document.getElementById('results-message').textContent = 'è¡¨ç¾ä¸éŒ¯ï¼';
    document.getElementById('results-message').style.color = 'var(--accent-amber)';
    document.getElementById('results-detail').textContent = 'å¤§éƒ¨åˆ†åˆä½µç—‡éƒ½èƒ½æ­£ç¢ºåˆ¤æ–·ï¼Œå»ºè­°å†è¤‡ç¿’æœªç­”å°çš„éƒ¨åˆ†ã€‚';
  } else {
    circle.className = 'results-score-circle needs-work';
    document.getElementById('results-message').textContent = 'éœ€è¦åŠ æ²¹';
    document.getElementById('results-message').style.color = 'var(--accent-coral)';
    document.getElementById('results-detail').textContent = 'å»ºè­°é‡æ–°è¤‡ç¿’å„åˆä½µç—‡çš„è‡¨åºŠç‰¹å¾µï¼Œå¤šè§€å¯Ÿã€å¤šç·´ç¿’ã€‚';
  }

  var html = '';
  for (var i = 0; i < gameState.results.length; i++) {
    var r = gameState.results[i];
    html += '<div class="results-row">' +
      '<span class="r-icon">' + (r.correct ? '\u2713' : '\u2717') + '</span>' +
      '<span class="r-name">' + r.condition.name + '</span>' +
      '<span class="r-result ' + (r.correct ? 'pass' : 'fail') + '">' +
      (r.correct ? 'PASS' : 'FAIL') + '</span></div>';
  }
  document.getElementById('results-breakdown').innerHTML = html;
}

function restartGame() {
  document.getElementById('results-screen').style.display = 'none';
  startGame();
}

// ==================== EVENT HANDLERS ====================
document.addEventListener('DOMContentLoaded', function() {
  var zones = document.querySelectorAll('.hotspot-zone');
  for (var i = 0; i < zones.length; i++) {
    zones[i].addEventListener('click', function() {
      var zone = this.getAttribute('data-zone');
      if (zone && !gameState.answered) {
        discoverClue(zone);
      }
    });
  }
});

document.addEventListener('keydown', function(e) {
  if (gameState.answered) return;
  var num = parseInt(e.key);
  if (num >= 1 && num <= 5) {
    selectDiagnosis(DIAGNOSIS_OPTIONS[num - 1].id);
  }
});

var resizeTimer;
window.addEventListener('resize', function() {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(function() {
    if (document.getElementById('game-screen').style.display !== 'none') {
      initWaveform();
      var cond = CONDITIONS[gameState.order[gameState.currentRound]];
      if (cond && waveformCtx) {
        if (waveformAnim) cancelAnimationFrame(waveformAnim);
        drawWaveform(cond.waveformStyle);
      }
    }
  }, 250);
});
</script>
</body>
</html>
